## MySQL 索引及优化

### 索引

索引是帮助 MySQL 高效获取数据的数据结构，即本质上就是一种数据结构。数据库在存储数据之外还维护者满足特定查找算法的数据结构，这些数据结构以某种方式引用数据，这样就可以在数据结构上实现高级的查找算法，一种索引方式如下图所示：

![索引](http://img.sangzhenya.com/Snipaste_2019-10-13_17-26-48.png)

一般来说索引文件本身也很大，所以并不会全部存储在内存中，往往以索引文件的形式存储在磁盘上。

### 索引分类

#### 数据结构分类：

1. B+ 树索引
2. Hash 索引
3. FullText 索引
4. R-Tree 索引

#### 物理存储分类：

1. 聚集索引
2. 非聚集索引

#### 逻辑分类

1. 单值索引：即一个索引仅包含单个列，一个表中可以有多个单值索引。
2. 唯一索引：索引列的值必须是唯一的，允许有空值。
3. 复合索引：即一个索引包含多个列。

### 索引结构

平常所说的索引都是指的 B 说结构组织的索引。其中聚集索引、次要索引、覆盖索引、前缀索引和唯一索引默认都是使用 B+ 树索引。此外还有哈希索引等。

B+ 树是 B 树的一种变形，非叶子节点只保存索引，不保存实际数据，数据都保存在叶子节点。形式如下图所示：

![B+ 树](http://img.sangzhenya.com/Snipaste_2019-10-13_17-40-22.png)

使用 B+ 树的原因主要有以下几点。

首先是 B+ 树的磁盘读写代价更低，B+ 树的内部节点没有指向关键词具体信息的指针，因此其内部节点相对于 B 树更新，如果把所有同一内部节点的关键字存放在同一盘块中，那么盘块所能容纳的关键字数量也越多，一次性读入内存的需要查找的关键词也就越多，相对 IO 读写次数就降低了。

其次 B+ 树的查询效率更稳定，由于非终结点并不是指向文件内容节点，而只是叶子节点中关键词字的索引。所以任何关键词查找都会走一条从根节点到叶子节点的路，所有关键词查询的路径长度相同，每一个数据查询效率相当。

最后 B+ 树的数据存储在叶子结点中，分支节点均为索引，方便入库，只需要扫描一遍叶子结点即可，对于 B 树因为其分支节点同样存储着数据，所以要找到具体的数据需要进行一次树的遍历，所以 B+ 树更适合在区间查询的情况。

### 索引的适用场景

#### 优势

提高数据检索效率，降低数据库的 IO 成本。降低数据排序的成本，降低 CPU 的消耗。需要创建索引场景如下：

1. 主键自动建立唯一索引
2. 频繁作为查询条件的字段应该创建索引
3. 查询中与其他表关联的字段，外键关系建立索引
4. 查询中排序的字段
5. 查询中统计或者分组字段

#### 劣势

索引会占据空间的。每次添加或更新索引列的字段，都要更新索引，会降低更新锁的表速度，对大数据量的表需要花时间研究最优索引。不需要创建索引的场景如下：

1. 频繁更新的字段不适合创建索引
2. where 条件中用不到的字段
3. 表记录太少
4. 经常增删改的表
5. 数据重复且分布平均的表字段，因此应该只是为最经常查询和最经常排序的数据列建立索引

### 常见瓶颈

一般发生在数据装入内存或从磁盘上读取数据的时候可能会出现 CPU 饱和，而 磁盘 IO 瓶颈发生在装入数据远大于内存容量的时候。

### Explain 分析

### 索引优化





参考：

1. [为什么MySQL数据库索引选择使用B+树？](https://blog.csdn.net/xlgen157387/article/details/79450295)